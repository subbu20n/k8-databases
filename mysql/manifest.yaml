apiVersion: v1 
kind: Secret 
metadata: 
      name: mysql 
      labels: 
         component: mysql 
         project: roboshop 
         tier: database 
type: Opaque 
data: 
   MYSQL_ROOT_PASSWORD: ""         
--- 
apiVersion: v1 
kind: Service 
metadata: 
      name: mysql-headless 
      namespace: roboshop 
      labels: 
         component: mysql 
         project: roboshop 
         tier: database 
spec: 
   clusterIP: None 
   selector: 
       component: mysql 
       project: roboshop 
       tier: database 
   ports: 
   - protocol: TCP 
     port: 3306 # service port
     targetPort: 3306 # container port 
--- 
apiVersion: v1 
kind: Service 
metadata: 
      name: mysql 
      namespace: roboshop 
      labels: 
         component: mysql 
         project: roboshop 
         tier: database 
spec: 
   selector: 
       component: mysql 
       project: roboshop 
       tier: database 
   ports: 
   - protocol: TCP 
     port: 3306 # service port 
     targetPort: 3306 # container port 
--- 

apiVersion: apps/v1 
kind: StatefulSet 
metadata: 
       name: mysql 
       namespace: roboshop 
       labels: 
          component: mysql 
          project: roboshop 
          tier: database 
spec: 
   selector: 
       matchLabels: 
             component: mysql 
             project: roboshop 
             tier: database # has to match .spec .template .metadata.labels 
   serviceName: "mysql-headless" # this should be the headless server                     
   replicas: 2 # by default 1 
   template: 
       metadata: 
            labels: 
               component: mysql 
               project: roboshop 
               tier: database 
       spec: 
          containers: 
          - name: mysql 
            image: subbu2/mysql:v1 
            envFrom:
            - secretRef: 
                 name: mysql 
            volumeMounts: 
            - name: mysql-data 
              mountPath: /var/lib/mysql 
   # this is nothing but pvc, you can directly cretae here 
   volumeClaimTemplates: 
   - metadata: 
            name: mysql-data 
     spec: 
       accessModes: ["ReadWriteOnce"] 
       storageClassName: "roboshop-ebs"         
       resources: 
           requests: 
              storage: 2Gi 

